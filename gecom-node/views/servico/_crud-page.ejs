<style>
  .ibox-title { padding: 15px 90px 20px 15px; }
  .service-title-bar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    flex-wrap: wrap;
  }
  .service-title-left { min-width: 280px; flex: 1 1 auto; }
  .service-title-tools {
    float: none !important;
    margin-top: 0 !important;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }
  #serviceSavedViewsHost .sv-bar { margin-top: -2px; }
  #serviceSavedViewsHost .sv-actions { margin-left: unset !important; }
  .service-counters { display: inline-flex; align-items: center; gap: 10px; margin-right: 10px; color: #777; font-size: 12px; }
  .service-message { display: none; margin-bottom: 10px; }
  .service-message.is-open { display: block; }
  .service-actions-inline { display: inline-flex; gap: 6px; white-space: nowrap; }
  .service-filter-row input,
  .service-filter-row select { min-width: 120px; }
  th.sortable { cursor: pointer; user-select: none; }
  th.sortable .sort-indicator { margin-left: 6px; font-size: 11px; opacity: .75; }
  .service-side {
    position: fixed;
    top: 0;
    right: -520px;
    width: 500px;
    max-width: calc(100vw - 20px);
    height: 100vh;
    background: #fff;
    z-index: 1000010;
    box-shadow: -4px 0 20px rgba(0,0,0,.18);
    display: flex;
    flex-direction: column;
    transition: right .2s ease;
  }
  .service-side.is-open { right: 0; }
  .service-side-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.25);
    z-index: 1000009;
    display: none;
  }
  .service-side-overlay.is-open { display: block; }
  .service-side-head { padding: 14px 16px; border-bottom: 1px solid #e7eaec; display: flex; justify-content: space-between; align-items: center; }
  .service-side-body { padding: 14px 16px; overflow-y: auto; flex: 1; }
  .service-side-footer { padding: 12px 16px; border-top: 1px solid #e7eaec; display: flex; justify-content: end; gap: 8px; }
</style>

<div class="row animated fadeInRight" style="margin-top: 25px;">
  <div class="col-lg-12">
    <div class="ibox">
      <div class="ibox-title service-title-bar">
        <div id="serviceSavedViewsHost" class="service-title-left"></div>
        <div class="ibox-tools service-title-tools">
          <span class="service-counters"><span id="serviceCountLabel">Exibindo 0 de 0</span></span>
          <button id="serviceRefreshBtn" type="button" class="btn btn-sm btn-white"><i class="fa fa-refresh"></i> Atualizar</button>
          <button id="serviceNewBtn" type="button" class="btn btn-sm btn-primary"><i class="fa fa-plus"></i> Novo</button>
        </div>
      </div>
      <div class="ibox-content">
        <div id="serviceMessage" class="alert service-message"></div>

        <div class="table-responsive">
          <table class="table table-striped table-hover" id="serviceTable">
            <thead>
              <tr id="serviceFiltersRow" class="service-filter-row"></tr>
              <tr id="serviceHeaderRow"></tr>
            </thead>
            <tbody id="serviceRows"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="serviceSideOverlay" class="service-side-overlay"></div>
<aside id="serviceSidePanel" class="service-side" aria-hidden="true">
  <div class="service-side-head">
    <h4 id="serviceFormTitle" style="margin:0;">Novo</h4>
    <button id="serviceCloseBtn" type="button" class="btn btn-xs btn-default"><i class="fa fa-times"></i></button>
  </div>
  <form id="serviceForm" class="service-side-body">
    <input id="serviceRowId" type="hidden" />
    <div id="serviceFieldsContainer" class="row">
      <% (servicePage?.formFields || []).forEach(function(field){ %>
        <div class="col-md-6">
          <div class="form-group">
            <label for="field_<%= field.name %>"><%= field.label %><%= field.required ? " *" : "" %></label>
            <% if (field.type === "textarea") { %>
              <textarea id="field_<%= field.name %>" data-name="<%= field.name %>" data-type="<%= field.type %>" data-required="<%= field.required ? "1" : "0" %>" class="form-control" rows="3"></textarea>
            <% } else if (field.type === "checkbox") { %>
              <div style="padding-top:6px;">
                <label style="font-weight:normal;">
                  <input id="field_<%= field.name %>" data-name="<%= field.name %>" data-type="<%= field.type %>" data-required="<%= field.required ? "1" : "0" %>" type="checkbox" />
                  Sim
                </label>
              </div>
            <% } else if (field.type === "select") { %>
              <select id="field_<%= field.name %>" data-name="<%= field.name %>" data-type="<%= field.type %>" data-required="<%= field.required ? "1" : "0" %>" class="form-control"></select>
            <% } else { %>
              <input id="field_<%= field.name %>" data-name="<%= field.name %>" data-type="<%= field.type || "text" %>" data-required="<%= field.required ? "1" : "0" %>" class="form-control" type="<%= field.type || "text" %>" />
            <% } %>
          </div>
        </div>
      <% }); %>
    </div>
  </form>
  <div class="service-side-footer">
    <button id="serviceCancelBtn" type="button" class="btn btn-white">Cancelar</button>
    <button id="serviceSaveBtn" type="submit" form="serviceForm" class="btn btn-primary"><i class="fa fa-save"></i> Salvar</button>
  </div>
</aside>

<script>
  window.__SERVICE_PAGE_CONFIG = <%- safeJson(servicePage || {}) %>;
</script>

<% contentFor('scripts') %>
  <script src="/js/servico/serviceApi.js"></script>
  <script src="/js/servico/crud.page.js"></script>
<% %>

<link href="/Assets/inspinia/css/plugins/toastr/toastr.min.css" rel="stylesheet" />
<%
  const bootstrapMode = !!billingBootstrapMode;
%>
<style>
  .billing-card { margin-bottom: 20px; }
  .billing-muted { color: #888; font-size: 12px; }
  .billing-table td, .billing-table th { vertical-align: middle !important; }
  .billing-list-group { max-height: 360px; overflow-y: auto; }
  .billing-inline-actions { display: flex; gap: 6px; align-items: center; }
  .billing-inline-actions input[type="number"] { width: 90px; }
</style>

<div class="row animated fadeInRight" style="margin-top: 25px;">
  <div class="col-lg-12">
    <div class="ibox billing-card">
      <div class="ibox-title">
        <h5>Administracao de Planos e Modulos</h5>
      </div>
      <div class="ibox-content">
        <% if (bootstrapMode) { %>
          <div class="alert alert-warning">
            Modo bootstrap ativo. Esta sessao temporaria permite criar e editar apenas modulos e planos.
          </div>
        <% } %>
        <ul class="nav nav-tabs" id="billingTabs">
          <li class="active"><a href="#tab-modulos" data-toggle="tab">Modulos</a></li>
          <li><a href="#tab-planos" data-toggle="tab">Planos</a></li>
          <% if (!bootstrapMode) { %>
            <li><a href="#tab-assinatura" data-toggle="tab">Assinatura do Tenant</a></li>
            <li><a href="#tab-overrides" data-toggle="tab">Overrides do Tenant</a></li>
          <% } %>
        </ul>

        <div class="tab-content" style="padding-top: 15px;">
          <div class="tab-pane active" id="tab-modulos">
            <div class="billing-inline-actions" style="margin-bottom: 12px;">
              <button id="btnRecarregarModulos" class="btn btn-white btn-sm"><i class="fa fa-refresh"></i> Atualizar</button>
              <button id="btnNovoModulo" class="btn btn-primary btn-sm"><i class="fa fa-plus"></i> Novo modulo</button>
            </div>
            <div class="table-responsive">
              <table class="table table-striped table-bordered billing-table">
                <thead>
                  <tr>
                    <th>Codigo</th>
                    <th>Nome</th>
                    <th>Areas</th>
                    <th>Preco mensal</th>
                    <th>Ativo</th>
                    <th style="width: 170px;">Acoes</th>
                  </tr>
                </thead>
                <tbody id="billingModulesBody"></tbody>
              </table>
            </div>
          </div>

          <div class="tab-pane" id="tab-planos">
            <div class="row">
              <div class="col-md-4">
                <div class="billing-inline-actions" style="margin-bottom: 10px;">
                  <button id="btnRecarregarPlanos" class="btn btn-white btn-sm"><i class="fa fa-refresh"></i> Atualizar</button>
                  <button id="btnNovoPlano" class="btn btn-primary btn-sm"><i class="fa fa-plus"></i> Novo plano</button>
                </div>
                <div class="list-group billing-list-group" id="billingPlansList"></div>
              </div>
              <div class="col-md-8">
                <h4 id="billingSelectedPlanTitle">Selecione um plano</h4>
                <p class="billing-muted">Adicione modulos, ordene e marque se estao inclusos.</p>

                <div class="well well-sm">
                  <div class="row">
                    <div class="col-md-6">
                      <label>Modulo</label>
                      <select id="billingAddPlanModuleSelect" class="form-control"></select>
                    </div>
                    <div class="col-md-3">
                      <label>Ordem</label>
                      <input id="billingAddPlanModuleSortOrder" type="number" class="form-control" value="0" />
                    </div>
                    <div class="col-md-3">
                      <label>Incluso</label>
                      <div class="checkbox" style="margin-top: 8px;">
                        <label><input id="billingAddPlanModuleIncluded" type="checkbox" checked /> Sim</label>
                      </div>
                    </div>
                  </div>
                  <button id="btnAdicionarModuloPlano" class="btn btn-success btn-sm">
                    <i class="fa fa-plus"></i> Adicionar modulo ao plano
                  </button>
                </div>

                <div class="table-responsive">
                  <table class="table table-striped table-bordered billing-table">
                    <thead>
                      <tr>
                        <th>Modulo</th>
                        <th>Codigo</th>
                        <th>Ordem</th>
                        <th>Incluso</th>
                        <th style="width: 200px;">Acoes</th>
                      </tr>
                    </thead>
                    <tbody id="billingPlanModulesBody"></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <% if (!bootstrapMode) { %>
          <div class="tab-pane" id="tab-assinatura">
            <div class="well well-sm">
              <div class="row">
                <div class="col-md-7">
                  <label>Buscar tenant (nome, slug ou empresa)</label>
                  <input id="billingTenantSearchInput" type="text" class="form-control" placeholder="Digite para buscar tenant..." />
                </div>
                <div class="col-md-2">
                  <label>&nbsp;</label>
                  <button id="btnBuscarTenant" class="btn btn-primary btn-block">Buscar</button>
                </div>
                <div class="col-md-3">
                  <label>&nbsp;</label>
                  <p id="billingSelectedTenantLabel" class="form-control-static billing-muted">Nenhum tenant selecionado.</p>
                </div>
              </div>
              <div id="billingTenantSearchResults" class="list-group" style="margin-top: 10px;"></div>
            </div>

            <div class="row">
              <div class="col-md-4">
                <label>Plano</label>
                <select id="billingSubscriptionPlanId" class="form-control"></select>
              </div>
              <div class="col-md-4">
                <label>Status</label>
                <select id="billingSubscriptionStatus" class="form-control">
                  <option value="TRIAL">TRIAL</option>
                  <option value="ACTIVE">ACTIVE</option>
                  <option value="SUSPENDED">SUSPENDED</option>
                  <option value="CANCELED">CANCELED</option>
                </select>
              </div>
              <div class="col-md-4">
                <label>Inicio</label>
                <input id="billingSubscriptionStartsAt" type="datetime-local" class="form-control" />
              </div>
            </div>
            <div class="row" style="margin-top: 8px;">
              <div class="col-md-4">
                <label>Fim</label>
                <input id="billingSubscriptionEndsAt" type="datetime-local" class="form-control" />
              </div>
              <div class="col-md-4">
                <label>Renovacao</label>
                <input id="billingSubscriptionRenewsAt" type="datetime-local" class="form-control" />
              </div>
              <div class="col-md-4" style="padding-top: 24px;">
                <button id="btnSalvarAssinaturaTenant" class="btn btn-success">
                  <i class="fa fa-save"></i> Salvar assinatura
                </button>
              </div>
            </div>
          </div>

          <div class="tab-pane" id="tab-overrides">
            <p class="billing-muted">Selecione um tenant na aba de assinatura para editar os overrides.</p>
            <div class="table-responsive">
              <table class="table table-striped table-bordered billing-table">
                <thead>
                  <tr>
                    <th>Modulo</th>
                    <th>Codigo</th>
                    <th>Vem do Plano</th>
                    <th>Override</th>
                    <th>Status Final</th>
                    <th>Origem</th>
                    <th>Motivo</th>
                    <th style="width: 120px;">Acoes</th>
                  </tr>
                </thead>
                <tbody id="billingOverridesBody"></tbody>
              </table>
            </div>
          </div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="billingModuleModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
        <h4 class="modal-title" id="billingModuleModalTitle">Novo modulo</h4>
      </div>
      <div class="modal-body">
        <input type="hidden" id="billingModuleId" />
        <div class="form-group">
          <label>Codigo</label>
          <input id="billingModuleCode" class="form-control" />
        </div>
        <div class="form-group">
          <label>Nome</label>
          <input id="billingModuleName" class="form-control" />
        </div>
        <div class="form-group">
          <label>Descricao</label>
          <textarea id="billingModuleDescription" class="form-control"></textarea>
        </div>
        <div class="form-group">
          <label>Preco mensal (R$)</label>
          <input id="billingModulePrice" type="number" step="0.01" min="0" class="form-control" value="0" />
        </div>
        <div class="form-group">
          <label>Areas do modulo</label>
          <div class="row">
            <div class="col-xs-6">
              <label class="checkbox-inline"><input type="checkbox" class="billing-module-area" value="service" /> Servicos</label>
            </div>
            <div class="col-xs-6">
              <label class="checkbox-inline"><input type="checkbox" class="billing-module-area" value="sales" /> Vendas</label>
            </div>
            <div class="col-xs-6" style="margin-top:6px;">
              <label class="checkbox-inline"><input type="checkbox" class="billing-module-area" value="finance" /> Financeiro</label>
            </div>
            <div class="col-xs-6" style="margin-top:6px;">
              <label class="checkbox-inline"><input type="checkbox" class="billing-module-area" value="hr" /> RH</label>
            </div>
            <div class="col-xs-12" style="margin-top:6px;">
              <label class="checkbox-inline"><input type="checkbox" class="billing-module-area" value="po" /> Project & Operations</label>
            </div>
          </div>
          <p class="billing-muted" style="margin-top:6px;">Somente essas areas ficam visiveis para tenants com este modulo ativo.</p>
        </div>
        <div class="checkbox">
          <label><input id="billingModuleActive" type="checkbox" checked /> Ativo</label>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-white" data-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" id="btnSalvarModulo">Salvar</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="billingPlanModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
        <h4 class="modal-title" id="billingPlanModalTitle">Novo plano</h4>
      </div>
      <div class="modal-body">
        <input type="hidden" id="billingPlanId" />
        <div class="form-group">
          <label>Codigo</label>
          <input id="billingPlanCode" class="form-control" />
        </div>
        <div class="form-group">
          <label>Nome</label>
          <input id="billingPlanName" class="form-control" />
        </div>
        <div class="form-group">
          <label>Descricao</label>
          <textarea id="billingPlanDescription" class="form-control"></textarea>
        </div>
        <div class="form-group">
          <label>Preco mensal (R$)</label>
          <input id="billingPlanPrice" type="number" step="0.01" min="0" class="form-control" value="0" />
        </div>
        <div class="checkbox">
          <label><input id="billingPlanActive" type="checkbox" checked /> Ativo</label>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-white" data-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" id="btnSalvarPlano">Salvar</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="billingOverrideModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
        <h4 class="modal-title">Editar override</h4>
      </div>
      <div class="modal-body">
        <input type="hidden" id="billingOverrideModuleId" />
        <p id="billingOverrideModuleLabel"></p>
        <div class="form-group">
          <label>Habilitado</label>
          <select id="billingOverrideEnabled" class="form-control">
            <option value="true">Sim</option>
            <option value="false">Nao</option>
          </select>
        </div>
        <div class="form-group">
          <label>Motivo</label>
          <textarea id="billingOverrideReason" class="form-control" placeholder="Motivo opcional..."></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-white" data-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" id="btnSalvarOverride">Salvar override</button>
      </div>
    </div>
  </div>
</div>

<script src="/Assets/inspinia/js/plugins/toastr/toastr.min.js"></script>
<script src="/js/admin-billing.page.js"></script>

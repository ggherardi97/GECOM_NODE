<style>
  .cfg-toolbar { display:flex; gap:8px; align-items:center; justify-content:space-between; margin-bottom:12px; flex-wrap: wrap; }
  .cfg-layout { display:grid; grid-template-columns: 300px 1fr; gap:14px; }
  .cfg-card { border:1px solid #e7eaec; border-radius:4px; background:#fff; }
  .cfg-card .cfg-card-head { padding:10px 12px; border-bottom:1px solid #e7eaec; font-weight:600; }
  .cfg-card .cfg-card-body { padding:12px; }
  .cfg-area-list { list-style:none; margin:0; padding:0; min-height: 80px; }
  .cfg-area-list li { border:1px solid #e7eaec; border-radius:4px; padding:8px 10px; margin-bottom:8px; cursor:pointer; background:#fff; }
  .cfg-area-list li.active { border-color:#1ab394; background:#f3fbfa; }
  .cfg-item-list { list-style:none; margin:0; padding:0; min-height: 80px; }
  .cfg-item-list li { border:1px solid #e7eaec; border-radius:4px; padding:8px 10px; margin-bottom:8px; cursor:move; background:#fff; display:flex; justify-content:space-between; gap:8px; }
  .cfg-preview-box { border:1px dashed #ced4da; border-radius:6px; overflow:hidden; }
  .cfg-preview-topbar { padding:8px 10px; background: var(--cfg-topbar, #fff); }
  .cfg-preview-body { display:flex; min-height:140px; }
  .cfg-preview-nav { width:180px; padding:10px; color: var(--cfg-nav-text, #a7b1c2); background: var(--cfg-nav-bg, #2f4050); }
  .cfg-preview-content { flex:1; padding:12px; background:#f8f8f8; }
  .cfg-preview-button { display:inline-block; padding:6px 10px; border-radius:4px; color:#fff; background: var(--cfg-primary, #1ab394); }
  .cfg-badge { display:inline-block; font-size:11px; padding:2px 6px; border-radius:10px; background:#f3f3f4; }
  .cfg-toast { display:none; margin-bottom:10px; }
  .cfg-hidden { display:none !important; }
  .cfg-muted { color:#7d7d7d; }
  .cfg-table-pointer tbody tr { cursor: pointer; }
</style>

<div class="row animated fadeInRight" style="margin-top:25px;">
  <div class="col-lg-12">
    <div class="ibox">
      <div class="ibox-title">
        <h5 data-i18n="page.settings.title"><%= t('page.settings.title', { defaultValue: 'Configuracoes' }) %></h5>
      </div>
      <div class="ibox-content">
        <div id="cfgToast" class="alert cfg-toast"></div>

        <ul class="nav nav-tabs" id="cfgTabs">
          <li class="active"><a href="#cfg-tab-menu" data-toggle="tab" data-i18n="page.settings.tabs.menu"><%= t('page.settings.tabs.menu', { defaultValue: 'Menu Lateral' }) %></a></li>
          <li><a href="#cfg-tab-theme" data-toggle="tab" data-i18n="page.settings.tabs.theme"><%= t('page.settings.tabs.theme', { defaultValue: 'Aparencia' }) %></a></li>
          <li><a href="#cfg-tab-status" data-toggle="tab" data-i18n="page.settings.tabs.status"><%= t('page.settings.tabs.status', { defaultValue: 'Status de Entidades' }) %></a></li>
          <li><a href="#cfg-tab-options" data-toggle="tab" data-i18n="page.settings.tabs.options"><%= t('page.settings.tabs.options', { defaultValue: 'Option Sets' }) %></a></li>
          <li><a href="#cfg-tab-email" data-toggle="tab" data-i18n="page.settings.tabs.email"><%= t('page.settings.tabs.email', { defaultValue: 'Integracoes de E-mail' }) %></a></li>
        </ul>

        <div class="tab-content" style="margin-top:15px;">
          <div class="tab-pane active" id="cfg-tab-menu">
            <div class="cfg-toolbar">
              <div>
                <button type="button" class="btn btn-primary btn-sm" id="btnCfgSaveMenu"><i class="fa fa-save"></i> <%= t('page.settings.common.save', { defaultValue: 'Salvar' }) %></button>
                <button type="button" class="btn btn-white btn-sm" id="btnCfgReloadMenu"><i class="fa fa-refresh"></i> <%= t('page.settings.common.reload', { defaultValue: 'Recarregar' }) %></button>
              </div>
              <button type="button" class="btn btn-success btn-sm" id="btnCfgNewArea"><i class="fa fa-plus"></i> <%= t('page.settings.menu.newArea', { defaultValue: 'Nova area' }) %></button>
            </div>

            <div class="cfg-layout">
              <div class="cfg-card">
                <div class="cfg-card-head"><%= t('page.settings.menu.areas', { defaultValue: 'Areas' }) %></div>
                <div class="cfg-card-body">
                  <ul id="cfgAreaList" class="cfg-area-list"></ul>
                </div>
              </div>

              <div class="cfg-card">
                <div class="cfg-card-head"><%= t('page.settings.menu.areaEditor', { defaultValue: 'Editor da Area' }) %></div>
                <div class="cfg-card-body" id="cfgAreaEditor">
                  <p class="cfg-muted"><%= t('page.settings.menu.selectAreaHelp', { defaultValue: 'Selecione uma area para editar.' }) %></p>
                </div>
              </div>
            </div>
          </div>

          <div class="tab-pane" id="cfg-tab-theme">
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <label><%= t('page.settings.theme.primaryColor', { defaultValue: 'Cor primaria' }) %></label>
                  <input type="color" class="form-control" id="cfgThemePrimaryColor" />
                </div>
                <div class="form-group">
                  <label><%= t('page.settings.theme.navBgColor', { defaultValue: 'Cor de fundo do menu' }) %></label>
                  <input type="color" class="form-control" id="cfgThemeNavBgColor" />
                </div>
                <div class="form-group">
                  <label><%= t('page.settings.theme.navTextColor', { defaultValue: 'Cor de texto do menu' }) %></label>
                  <input type="color" class="form-control" id="cfgThemeNavTextColor" />
                </div>
                <div class="form-group">
                  <label><%= t('page.settings.theme.topbarBgColor', { defaultValue: 'Cor da topbar' }) %></label>
                  <input type="color" class="form-control" id="cfgThemeTopbarBgColor" />
                </div>
                <div class="form-group">
                  <label><%= t('page.settings.theme.layoutMode', { defaultValue: 'Modo de layout' }) %></label>
                  <select class="form-control" id="cfgThemeLayoutMode">
                    <option value="LIGHT">LIGHT</option>
                    <option value="DARK">DARK</option>
                  </select>
                </div>
                <div class="form-group">
                  <label><%= t('page.settings.theme.logoUrl', { defaultValue: 'Logo URL' }) %></label>
                  <input type="text" class="form-control" id="cfgThemeLogoUrl" placeholder="https://..." />
                </div>
                <div class="form-group">
                  <label><%= t('page.settings.theme.faviconUrl', { defaultValue: 'Favicon URL' }) %></label>
                  <input type="text" class="form-control" id="cfgThemeFaviconUrl" placeholder="https://..." />
                </div>
                <button type="button" class="btn btn-primary btn-sm" id="btnCfgSaveTheme"><i class="fa fa-save"></i> <%= t('page.settings.common.save', { defaultValue: 'Salvar' }) %></button>
              </div>
              <div class="col-md-6">
                <div class="cfg-preview-box" id="cfgThemePreview">
                  <div class="cfg-preview-topbar"><strong><%= t('page.settings.theme.preview.topbar', { defaultValue: 'Topbar' }) %></strong></div>
                  <div class="cfg-preview-body">
                    <div class="cfg-preview-nav">
                      <div style="margin-bottom:8px;"><strong><%= t('page.settings.theme.preview.menu', { defaultValue: 'Menu' }) %></strong></div>
                      <div><%= t('page.layout.menu.dashboard', { defaultValue: 'Dashboard' }) %></div>
                      <div><%= t('page.layout.menu.processes', { defaultValue: 'Processos' }) %></div>
                      <div><%= t('page.layout.menu.finance', { defaultValue: 'Financeiro' }) %></div>
                    </div>
                    <div class="cfg-preview-content">
                      <div class="cfg-preview-button"><%= t('page.settings.theme.preview.primaryButton', { defaultValue: 'Botao primario' }) %></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="tab-pane" id="cfg-tab-status">
            <%- include('StatusConfigs') %>
          </div>

          <div class="tab-pane" id="cfg-tab-options">
            <div class="cfg-toolbar">
              <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
                <select class="form-control" id="cfgOptionEntity" style="min-width:240px;"></select>
                <select class="form-control" id="cfgOptionField" style="min-width:240px;"></select>
                <button type="button" class="btn btn-primary btn-sm" id="btnCfgLoadOptionSets"><i class="fa fa-search"></i> <%= t('page.settings.options.load', { defaultValue: 'Carregar' }) %></button>
                <button type="button" class="btn btn-success btn-sm" id="btnCfgCreateOptionSet"><i class="fa fa-plus"></i> <%= t('page.settings.options.newSet', { defaultValue: 'Novo option set' }) %></button>
              </div>
            </div>

            <div class="row">
              <div class="col-md-5">
                <div class="cfg-card">
                  <div class="cfg-card-head"><%= t('page.settings.options.sets', { defaultValue: 'Option Sets' }) %></div>
                  <div class="cfg-card-body">
                    <table class="table table-striped table-bordered cfg-table-pointer" id="cfgOptionSetTable">
                      <thead>
                        <tr>
                          <th><%= t('page.settings.options.entity', { defaultValue: 'Entidade' }) %></th>
                          <th><%= t('page.settings.options.field', { defaultValue: 'Campo' }) %></th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
              <div class="col-md-7">
                <div class="cfg-card">
                  <div class="cfg-card-head"><%= t('page.settings.options.options', { defaultValue: 'Opcoes' }) %></div>
                  <div class="cfg-card-body">
                    <div style="display:flex; gap:8px; margin-bottom:10px; align-items:end; flex-wrap:wrap;">
                      <div>
                        <label><%= t('page.settings.options.value', { defaultValue: 'Value' }) %></label>
                        <input type="text" class="form-control" id="cfgOptionValue" placeholder="NOVO_STATUS" />
                      </div>
                      <div>
                        <label><%= t('page.settings.options.label', { defaultValue: 'Label' }) %></label>
                        <input type="text" class="form-control" id="cfgOptionLabel" placeholder="Novo status" />
                      </div>
                      <div>
                        <label><%= t('page.settings.options.color', { defaultValue: 'Cor' }) %></label>
                        <input type="color" class="form-control" id="cfgOptionColor" value="#64748B" />
                      </div>
                      <div>
                        <label><%= t('page.settings.options.sortOrder', { defaultValue: 'Ordem' }) %></label>
                        <input type="number" class="form-control" id="cfgOptionSortOrder" value="0" />
                      </div>
                      <button type="button" class="btn btn-primary btn-sm" id="btnCfgAddOption"><i class="fa fa-plus"></i> <%= t('page.settings.options.addOption', { defaultValue: 'Adicionar opcao' }) %></button>
                    </div>

                    <table class="table table-striped table-bordered" id="cfgOptionTable">
                      <thead>
                        <tr>
                          <th><%= t('page.settings.options.value', { defaultValue: 'Value' }) %></th>
                          <th><%= t('page.settings.options.label', { defaultValue: 'Label' }) %></th>
                          <th><%= t('page.settings.options.color', { defaultValue: 'Cor' }) %></th>
                          <th><%= t('page.settings.options.sortOrder', { defaultValue: 'Ordem' }) %></th>
                          <th><%= t('page.settings.options.active', { defaultValue: 'Ativo' }) %></th>
                          <th><%= t('page.settings.options.actions', { defaultValue: 'Acoes' }) %></th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="tab-pane" id="cfg-tab-email">
            <div class="cfg-toolbar">
              <button type="button" class="btn btn-primary btn-sm" id="btnCfgNewEmailIntegration"><i class="fa fa-plus"></i> <%= t('page.settings.email.new', { defaultValue: 'Nova integracao' }) %></button>
              <button type="button" class="btn btn-white btn-sm" id="btnCfgReloadEmailIntegration"><i class="fa fa-refresh"></i> <%= t('page.settings.common.reload', { defaultValue: 'Recarregar' }) %></button>
            </div>

            <table class="table table-striped table-bordered" id="cfgEmailTable">
              <thead>
                <tr>
                  <th><%= t('page.settings.email.provider', { defaultValue: 'Provider' }) %></th>
                  <th><%= t('page.settings.email.displayName', { defaultValue: 'Nome' }) %></th>
                  <th><%= t('page.settings.email.senderEmail', { defaultValue: 'Email remetente' }) %></th>
                  <th><%= t('page.settings.email.smtp', { defaultValue: 'SMTP' }) %></th>
                  <th><%= t('page.settings.email.active', { defaultValue: 'Ativo' }) %></th>
                  <th><%= t('page.settings.options.actions', { defaultValue: 'Acoes' }) %></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="cfgEmailModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
        <h4 class="modal-title" id="cfgEmailModalTitle"><%= t('page.settings.email.new', { defaultValue: 'Nova integracao' }) %></h4>
      </div>
      <div class="modal-body">
        <input type="hidden" id="cfgEmailId" />
        <div class="row">
          <div class="col-md-4 form-group">
            <label><%= t('page.settings.email.provider', { defaultValue: 'Provider' }) %></label>
            <select class="form-control" id="cfgEmailProvider">
              <option value="SMTP">SMTP</option>
              <option value="GMAIL">GMAIL</option>
              <option value="OUTLOOK">OUTLOOK</option>
            </select>
          </div>
          <div class="col-md-4 form-group">
            <label><%= t('page.settings.email.displayName', { defaultValue: 'Nome' }) %></label>
            <input type="text" class="form-control" id="cfgEmailDisplayName" />
          </div>
          <div class="col-md-4 form-group">
            <label><%= t('page.settings.email.senderEmail', { defaultValue: 'Email remetente' }) %></label>
            <input type="email" class="form-control" id="cfgEmailSenderEmail" />
          </div>
        </div>

        <div class="row">
          <div class="col-md-3 form-group">
            <label><%= t('page.settings.email.smtpHost', { defaultValue: 'SMTP Host' }) %></label>
            <input type="text" class="form-control" id="cfgEmailSmtpHost" />
          </div>
          <div class="col-md-2 form-group">
            <label><%= t('page.settings.email.smtpPort', { defaultValue: 'SMTP Port' }) %></label>
            <input type="number" class="form-control" id="cfgEmailSmtpPort" value="587" />
          </div>
          <div class="col-md-3 form-group">
            <label><%= t('page.settings.email.smtpUser', { defaultValue: 'SMTP User' }) %></label>
            <input type="text" class="form-control" id="cfgEmailSmtpUser" />
          </div>
          <div class="col-md-4 form-group">
            <label><%= t('page.settings.email.smtpPassword', { defaultValue: 'SMTP Password' }) %></label>
            <input type="password" class="form-control" id="cfgEmailSmtpPassword" placeholder="****" />
          </div>
        </div>

        <div class="row">
          <div class="col-md-4 form-group">
            <label><%= t('page.settings.email.clientId', { defaultValue: 'Client ID' }) %></label>
            <input type="text" class="form-control" id="cfgEmailClientId" />
          </div>
          <div class="col-md-4 form-group">
            <label><%= t('page.settings.email.clientSecret', { defaultValue: 'Client Secret' }) %></label>
            <input type="password" class="form-control" id="cfgEmailClientSecret" placeholder="****" />
          </div>
          <div class="col-md-4 form-group">
            <label><%= t('page.settings.email.tenantDomain', { defaultValue: 'Tenant Domain' }) %></label>
            <input type="text" class="form-control" id="cfgEmailTenantDomain" />
          </div>
        </div>

        <div class="checkbox">
          <label><input id="cfgEmailIsActive" type="checkbox" /> <%= t('page.settings.email.active', { defaultValue: 'Ativo' }) %></label>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" id="btnCfgEmailTest"><i class="fa fa-plug"></i> <%= t('page.settings.email.testSmtp', { defaultValue: 'Testar SMTP' }) %></button>
        <button type="button" class="btn btn-white" data-dismiss="modal"><%= t('page.settings.common.cancel', { defaultValue: 'Cancelar' }) %></button>
        <button type="button" class="btn btn-primary" id="btnCfgEmailSave"><%= t('page.settings.common.save', { defaultValue: 'Salvar' }) %></button>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.3/Sortable.min.js"></script>
<script src="/js/admin/configuracoes.page.js"></script>

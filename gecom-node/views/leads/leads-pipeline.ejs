<link rel="stylesheet" href="../Assets/inspinia/css/plugins/daterangepicker/daterangepicker-bs3.css">
<style>
  .lead-toolbar { display: flex; gap: 10px; align-items: end; flex-wrap: wrap; margin-bottom: 15px; }
  .lead-toolbar .form-group { margin-bottom: 0; min-width: 180px; }
  .lead-toolbar .actions { margin-left: auto; display: flex; gap: 8px; }
  .pipeline-board { display: flex; gap: 12px; overflow-x: auto; padding-bottom: 8px; min-height: 380px; }
  .lead-column { min-width: 290px; width: 290px; background: #f8f8f9; border: 1px solid #e7eaec; border-radius: 6px; }
  .lead-column-head { padding: 10px; border-bottom: 1px solid #e7eaec; display: flex; justify-content: space-between; align-items: center; }
  .lead-column-head h4 { margin: 0; font-size: 14px; font-weight: 600; }
  .lead-column-counters { text-align: right; }
  .lead-column-body { padding: 10px; min-height: 220px; }
  .lead-column-body.over { background: #e9f7f8; }
  .lead-card { border: 1px solid #dfe3e6; border-radius: 6px; background: #fff; padding: 10px; margin-bottom: 10px; cursor: move; }
  .lead-card.dragging { opacity: .6; }
  .lead-card-top { display: flex; justify-content: space-between; align-items: start; gap: 8px; margin-bottom: 6px; }
  .lead-title { font-size: 13px; line-height: 1.25; }
  .lead-sub { font-size: 12px; color: #777; margin-bottom: 6px; }
  .lead-meta { display: flex; justify-content: space-between; font-size: 11px; color: #777; margin-bottom: 4px; }
  .lead-actions { display: flex; justify-content: end; gap: 4px; margin-top: 8px; }
  .empty-col { padding: 12px; color: #888; font-size: 12px; text-align: center; border: 1px dashed #d5d5d5; border-radius: 6px; background: #fff; }
  #leadsPipelineLoading { display: none; margin-bottom: 10px; }
</style>

<div class="row animated fadeInRight" style="margin-top: 25px;">
  <div class="col-lg-12">
    <div class="ibox">
      <div class="ibox-title">
        <h5><%= t('page.leads.pipeline.title') %></h5>
      </div>
      <div class="ibox-content">
        <div id="leadsPipelineLoading" class="alert alert-info">
          <i class="fa fa-spinner fa-spin"></i> <%= t('page.leads.common.loading') %>
        </div>

        <div class="lead-toolbar">
          <div class="form-group">
            <label><%= t('page.leads.filters.search') %></label>
            <input id="leadSearchFilter" type="text" class="form-control input-sm" placeholder="<%= t('page.leads.filters.searchPlaceholder') %>" />
          </div>
          <div class="form-group">
            <label><%= t('page.leads.filters.owner') %></label>
            <select id="leadOwnerFilter" class="form-control input-sm">
              <option value=""><%= t('page.leads.filters.allOwners') %></option>
            </select>
          </div>
          <div class="form-group">
            <label><%= t('page.leads.filters.status') %></label>
            <select id="leadStatusFilter" class="form-control input-sm">
              <option value=""><%= t('page.leads.filters.allStatus') %></option>
              <option value="NEW">NEW</option>
              <option value="WORKING">WORKING</option>
              <option value="NURTURING">NURTURING</option>
              <option value="QUALIFIED">QUALIFIED</option>
              <option value="CONVERTED">CONVERTED</option>
              <option value="DISQUALIFIED">DISQUALIFIED</option>
            </select>
          </div>
          <div class="form-group">
            <label><%= t('page.leads.filters.source') %></label>
            <select id="leadSourceFilter" class="form-control input-sm">
              <option value=""><%= t('page.leads.filters.allSources') %></option>
              <option value="WEBSITE">WEBSITE</option>
              <option value="REFERRAL">REFERRAL</option>
              <option value="SOCIAL">SOCIAL</option>
              <option value="PHONE">PHONE</option>
              <option value="EMAIL">EMAIL</option>
              <option value="OTHER">OTHER</option>
            </select>
          </div>
          <div class="form-group">
            <label><%= t('page.leads.filters.createdRange') %></label>
            <div class="input-group">
              <input id="leadCreatedRangeFilter" type="text" class="form-control input-sm" placeholder="dd/mm/aaaa - dd/mm/aaaa" autocomplete="off" />
              <span class="input-group-addon" id="leadCreatedRangeBtn"><i class="fa fa-calendar"></i></span>
            </div>
          </div>
          <div class="actions">
            <button id="btnLeadFiltersClear" type="button" class="btn btn-sm btn-white"><%= t('page.leads.filters.clear') %></button>
            <button id="btnLeadList" type="button" class="btn btn-sm btn-default"><%= t('page.leads.pipeline.goList') %></button>
            <button id="btnLeadNew" type="button" class="btn btn-sm btn-primary"><%= t('page.leads.pipeline.newLead') %></button>
          </div>
        </div>

        <div id="leadsPipelineBoard" class="pipeline-board"></div>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="leadStatusModal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span>&times;</span></button>
        <h4 class="modal-title" id="leadStatusTitle"><%= t('page.leads.modal.statusTitle') %></h4>
      </div>
      <div class="modal-body">
        <input type="hidden" id="leadStatusLeadId">
        <input type="hidden" id="leadStatusMode">
        <div class="form-group">
          <label for="leadStatusReason"><%= t('page.leads.modal.reason') %></label>
          <input id="leadStatusReason" type="text" class="form-control" maxlength="255" />
        </div>
        <div class="form-group">
          <label for="leadStatusNotes"><%= t('page.leads.modal.notes') %></label>
          <textarea id="leadStatusNotes" class="form-control" rows="3"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-white" data-dismiss="modal"><%= t('page.leads.common.cancel') %></button>
        <button type="button" class="btn btn-primary" id="btnLeadStatusSave"><%= t('page.leads.common.save') %></button>
      </div>
    </div>
  </div>
</div>

<% contentFor('scripts') %>
  <script src="../Assets/inspinia/js/plugins/fullcalendar/moment.min.js"></script>
  <script src="../Assets/inspinia/js/plugins/daterangepicker/daterangepicker.js"></script>
  <script src="/js/common/apiClient.js"></script>
  <script src="/js/leads/leads.pipeline.js"></script>
<% %>
